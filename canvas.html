<!DOCTYPE html>
<html>
<head>
	<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.2.min.js">
	</script>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<canvas>
	Your browser does not support the HTML5 canvas tag.
	</canvas>


<script>
	var canvas = document.querySelector('canvas');	
	var ctx = canvas.getContext('2d');
	 
	canvas.style.width='100%';
	canvas.style.height='100%';
	canvas.width  = $(canvas).parent().width();
	canvas.height = $(canvas).parent().height();

	var translatePos = {
          x: 0,
          y: 0
        };
	var scale = 1.0; 
	var rotAngle = 0;

	function draw(image, scale, translatePos, rotAngle) {
		ctx.clearRect(0, 0, canvas.width, canvas.height);
	    ctx.save();
	    ctx.translate(canvas.width / 2, canvas.height / 2);
	    ctx.rotate(rotAngle);
	    ctx.scale(scale,scale);	
	    ctx.translate(translatePos.x,translatePos.y);  
		ctx.drawImage(image, -image.width / 2, -image.height / 2);
		ctx.restore();
		console.log(rotAngle);
	}

	function initImage(url)
	{
	   	var image = new Image();
	    image.onload = function()
	    {	     
	    	draw(image, scale, translatePos);       
	    }
	    image.src = url;
	    return image;
	}

	img = initImage("http://kartarkiv.turebergsif.se/map_images/593.jpg");

	canvas.addEventListener('click', function() {
		scale = scale * 1.2;
	   	draw(img, scale, translatePos, rotAngle);   
		return false;	   
	}, false);

	canvas.addEventListener('contextmenu', function() {
		scale = scale / 1.2;
	   	draw(img, scale, translatePos, rotAngle);   
		return false;	   
	}, false);
	

	function onKeyDown(evt) {
  		if (evt.keyCode == 39 || evt.keyCode == 68){
  			translatePos.x -= Math.cos(rotAngle) * img.width / 150;
  			translatePos.y += Math.sin(rotAngle) * img.width / 150;
  		}
  		else if (evt.keyCode == 37 || evt.keyCode == 65){
  			translatePos.x += Math.cos(rotAngle) * img.width / 150;
  			translatePos.y -= Math.sin(rotAngle) * img.width / 150;
  		}
  		else if (evt.keyCode == 38 || evt.keyCode == 87) {
  			translatePos.x += Math.sin(rotAngle) * img.width / 150 ;
  			translatePos.y += Math.cos(rotAngle) * img.width / 150;
  		}
  		else if (evt.keyCode == 40 || evt.keyCode == 83) {
  			translatePos.x -= Math.sin(rotAngle) * img.width / 150;
  			translatePos.y -= Math.cos(rotAngle) * img.width / 150;
  		}
  		else if (evt.keyCode == 81) rotAngle += 0.1;
  		else if (evt.keyCode == 69) rotAngle -= 0.1;

  		draw(img, scale, translatePos, rotAngle);
	}

$(document).keydown(onKeyDown);
$(document).keyup(onKeyUp);

</script>


</body>
</html>
